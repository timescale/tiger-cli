openapi: 3.0.3
info:
  title: Tiger Cloud API
  description: |
    A RESTful API for Tiger Cloud platform.
  version: 1.0.0
  license:
    name: Proprietary
    url: https://www.tigerdata.com/legal/terms
  contact:
    name: Tiger Data Support
    url: https://www.tigerdata.com/contact
servers:
  - url: http://localhost:8080
    description: Local development server
  - url: https://api.tigerdata.com/public/v1
    description: API server for Tiger Cloud

tags:
  - name: VPCs
    description: Manage VPCs and their peering connections.
  - name: Services
    description: Manage services, read replicas, and their associated actions.
  - name: Analytics
    description: Track analytics events.
  - name: File Imports
    description: Manage file import operations for CSV and Parquet files.

paths:
  /analytics/identify:
    post:
      tags:
        - Analytics
      summary: Identify a user
      description: Identifies a user with optional properties for analytics tracking.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                properties:
                  type: object
                  additionalProperties: true
                  description: Optional map of arbitrary properties associated with the user
                  example:
                    email: "user@example.com"
                    name: "John Doe"
      responses:
        '200':
          $ref: '#/components/responses/AnalyticsResponse'
        '4XX':
          $ref: '#/components/responses/ClientError'

  /analytics/track:
    post:
      tags:
        - Analytics
      summary: Track an analytics event
      description: Tracks an analytics event with optional properties.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - event
              properties:
                event:
                  type: string
                  description: The name of the event to track
                  example: service_created
                properties:
                  type: object
                  additionalProperties: true
                  description: Optional map of arbitrary properties associated with the event
                  example:
                    region: "us-east-1"
      responses:
        '200':
          $ref: '#/components/responses/AnalyticsResponse'
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/vpcs:
    get:
      tags:
        - VPCs
      parameters:
        - $ref: '#/components/parameters/ProjectId'
      summary: List All VPCs
      description: Retrieves a list of all Virtual Private Clouds (VPCs).
      responses:
        '200':
          description: A list of VPCs.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/VPC'
        '4XX':
          $ref: '#/components/responses/ClientError'
    post:
      tags:
        - VPCs
      parameters:
        - $ref: '#/components/parameters/ProjectId'
      summary: Create a VPC
      description: Creates a new Virtual Private Cloud (VPC).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VPCCreate'
      responses:
        '201':
          description: VPC created successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VPC'
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/vpcs/{vpc_id}:
    get:
      tags:
        - VPCs
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/VPCId'
      summary: Get a VPC
      description: Retrieves the details of a specific VPC by its ID.
      responses:
        '200':
          description: VPC details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VPC'
        '4XX':
          $ref: '#/components/responses/ClientError'
    delete:
      tags:
        - VPCs
      summary: Delete a VPC
      description: Deletes a specific VPC.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/VPCId'
      responses:
        '204':
          description: VPC deleted successfully.
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/vpcs/{vpc_id}/rename:
    post:
      tags:
        - VPCs
      summary: Rename a VPC
      description: Updates the name of a specific VPC.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/VPCId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VPCRename'
      responses:
        '200':
          description: VPC renamed successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VPC'
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/vpcs/{vpc_id}/peerings:
    get:
      tags:
        - VPCs
      summary: List VPC Peerings
      description: Retrieves a list of all VPC peering connections for a given VPC.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/VPCId'
      responses:
        '200':
          description: A list of VPC peering connections.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Peering'
        '4XX':
          $ref: '#/components/responses/ClientError'
    post:
      tags:
        - VPCs
      summary: Create a VPC Peering
      description: Creates a new VPC peering connection.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/VPCId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PeeringCreate'
      responses:
        '201':
          description: VPC peering created successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Peering'
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/vpcs/{vpc_id}/peerings/{peering_id}:
    get:
      tags:
        - VPCs
      summary: Get a VPC Peering
      description: Retrieves the details of a specific VPC peering connection.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/VPCId'
        - $ref: '#/components/parameters/PeeringId'
      responses:
        '200':
          description: VPC peering details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Peering'
        '4XX':
          $ref: '#/components/responses/ClientError'
    delete:
      tags:
        - VPCs
      summary: Delete a VPC Peering
      description: Deletes a specific VPC peering connection.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/VPCId'
        - $ref: '#/components/parameters/PeeringId'
      responses:
        '204':
          description: VPC peering deleted successfully.
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/services:
    get:
      tags:
        - Services
      summary: List All Services
      description: Retrieves a list of all services within a specific project.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
      responses:
        '200':
          description: A list of services.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Service'
        '4XX':
          $ref: '#/components/responses/ClientError'
    post:
      tags:
        - Services
      summary: Create a Service
      description: Creates a new database service within a project. This is an asynchronous operation.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ServiceCreate'
      responses:
        '202':
          description: Service creation request has been accepted.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Service'
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/services/{service_id}:
    get:
      tags:
        - Services
      summary: Get a Service
      description: Retrieves the details of a specific service by its ID.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
      responses:
        '200':
          description: Service details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Service'
        '4XX':
          $ref: '#/components/responses/ClientError'
    delete:
      tags:
        - Services
      summary: Delete a Service
      description: Deletes a specific service. This is an asynchronous operation.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
      responses:
        '202':
          description: Deletion request has been accepted.
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/services/{service_id}/attachToVPC:
    post:
      tags:
        - Services
      summary: Attach Service to VPC
      description: Associates a service with a VPC.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ServiceVPCInput'
      responses:
        '202':
          $ref: '#/components/responses/SuccessMessage'
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/services/{service_id}/detachFromVPC:
    post:
      tags:
        - Services
      summary: Detach Service from VPC
      description: Disassociates a service from its VPC.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ServiceVPCInput'
      responses:
        '202':
          $ref: '#/components/responses/SuccessMessage'
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/services/{service_id}/resize:
    post:
      tags:
        - Services
      summary: Resize a Service
      description: Changes the CPU and memory allocation for a specific service within a project.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResizeInput'
      responses:
        '202':
          description: Resize request has been accepted and is in progress.
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/services/{service_id}/enablePooler:
    post:
      tags:
        - Services
      summary: Enable Connection Pooler for a Service
      description: Activates the connection pooler for a specific service within a project.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
      responses:
        '200':
          $ref: '#/components/responses/SuccessMessage'
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/services/{service_id}/disablePooler:
    post:
      tags:
        - Services
      summary: Disable Connection Pooler for a Service
      description: Deactivates the connection pooler for a specific service within a project.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
      responses:
        '200':
          $ref: '#/components/responses/SuccessMessage'
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/services/{service_id}/forkService:
    post:
      tags:
        - Services
      summary: Fork a Service
      description: Creates a new, independent service within a project by taking a snapshot of an existing one.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ForkServiceCreate'
      responses:
        '202':
          description: Fork request accepted. The response contains the details of the new service being created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Service'
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/services/{service_id}/updatePassword:
    post:
      tags:
        - Services
      summary: Update Service Password
      description: Sets a new master password for the service within a project.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePasswordInput'
      responses:
        '204':
          description: Password updated successfully. No content returned.
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/services/{service_id}/setEnvironment:
    post:
      tags:
        - Services
      summary: Set Environment for a Service
      description: Sets the environment type for the service.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetEnvironmentInput'
      responses:
        '200':
          $ref: '#/components/responses/SuccessMessage'
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/services/{service_id}/setHA:
    post:
      tags:
        - Services
      summary: Change HA configuration for a Service
      description: Changes the HA configuration for a specific service. This is an asynchronous operation.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetHAReplicaInput'
      responses:
        '202':
          description: HA replica configuration updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Service'
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/services/{service_id}/replicaSets:
    get:
      tags:
        - Read Replica Sets
      summary: Get Read Replica Sets
      description: Retrieves a list of all read replica sets associated with a primary service within a project.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
      responses:
        '200':
          description: A list of read replica sets.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ReadReplicaSet'
        '4XX':
          $ref: '#/components/responses/ClientError'
    post:
      tags:
        - Read Replica Sets
      summary: Create a Read Replica Set
      description: Creates a new read replica set for a service. This is an asynchronous operation.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReadReplicaSetCreate'
      responses:
        '202':
          description: Read replica set creation request has been accepted.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReadReplicaSet'
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/services/{service_id}/replicaSets/{replica_set_id}:
    delete:
      tags:
        - Read Replica Sets
      summary: Delete a Read Replica Set
      description: Deletes a specific read replica set. This is an asynchronous operation.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
        - $ref: '#/components/parameters/ReplicaSetId'
      responses:
        '202':
          description: Deletion request has been accepted.
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/services/{service_id}/replicaSets/{replica_set_id}/resize:
    post:
      tags:
        - Read Replica Sets
      summary: Resize a Read Replica Set
      description: Changes the resource allocation for a specific read replica set.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
        - $ref: '#/components/parameters/ReplicaSetId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResizeInput'
      responses:
        '202':
          description: Resize request has been accepted and is in progress.
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/services/{service_id}/replicaSets/{replica_set_id}/enablePooler:
    post:
      tags:
        - Read Replica Sets
      summary: Enable Connection Pooler for a Read Replica
      description: Activates the connection pooler for a specific read replica set.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
        - $ref: '#/components/parameters/ReplicaSetId'
      responses:
        '200':
          $ref: '#/components/responses/SuccessMessage'
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/services/{service_id}/replicaSets/{replica_set_id}/disablePooler:
    post:
      tags:
        - Read Replica Sets
      summary: Disable Connection Pooler for a Read Replica
      description: Deactivates the connection pooler for a specific read replica set.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
        - $ref: '#/components/parameters/ReplicaSetId'
      responses:
        '200':
          $ref: '#/components/responses/SuccessMessage'
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/services/{service_id}/replicaSets/{replica_set_id}/setEnvironment:
    post:
      tags:
        - Read Replica Sets
      summary: Set Environment for a Read Replica
      description: Sets the environment type for the read replica set.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
        - $ref: '#/components/parameters/ReplicaSetId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetEnvironmentInput'
      responses:
        '200':
          $ref: '#/components/responses/SuccessMessage'
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/services/{service_id}/fileimports/presigned-url:
    post:
      tags:
        - File Imports
      summary: Generate Presigned Upload URL
      description: Generates a presigned S3 URL to upload a file up to 500MB. The file can then be imported using the INTERNAL source type.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GeneratePresignedURLInput'
      responses:
        '200':
          description: Presigned URL generated successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GeneratePresignedURLResponse'
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/services/{service_id}/fileimports:
    get:
      tags:
        - File Imports
      summary: List File Imports
      description: Retrieves a paginated list of file imports for a specific service.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
        - name: first
          in: query
          description: Number of items to fetch for forward pagination.
          schema:
            type: integer
            minimum: 1
            maximum: 100
            example: 20
        - name: last
          in: query
          description: Number of items to fetch for backward pagination.
          schema:
            type: integer
            minimum: 1
            maximum: 100
            example: 20
        - name: after
          in: query
          description: Cursor for fetching the next page.
          schema:
            type: string
            example: 'eyJpZCI6IjEwMCJ9'
        - name: before
          in: query
          description: Cursor for fetching the previous page.
          schema:
            type: string
            example: 'eyJpZCI6IjIwMCJ9'
        - name: label_selector
          in: query
          description: Filter by label key and value using k8s label selector syntax (e.g., 'source=s3-live-sync,s3-live-sync-id=123').
          schema:
            type: string
            example: 'source=s3-live-sync'
        - name: states
          in: query
          description: |
            Filter by import states (comma-separated). Valid states are:
            - IN_QUEUE: Import is queued for processing
            - RUNNING: Import is currently processing
            - RETRYING: Import is being retried after a failure
            - SUCCESS: Import completed successfully
            - FAILURE: Import failed
            - CANCELLED: Import was cancelled
            - PAUSED: Import is paused
            - SKIPPED: Import was skipped
          schema:
            type: string
            example: 'SUCCESS,FAILURE'
        - name: s3_key_prefix
          in: query
          description: Filter S3 imports by key prefix (e.g., 'data/2024/'). Only affects S3 source imports.
          schema:
            type: string
            example: 'data/2024/'
        - name: source_type
          in: query
          description: Filter by source type for optimized ordering. Supported values are S3, HTTP, INTERNAL.
          schema:
            type: string
            enum: [S3, HTTP, INTERNAL]
            example: 'S3'
      responses:
        '200':
          description: A paginated list of file imports.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListFileImportResponse'
        '4XX':
          $ref: '#/components/responses/ClientError'
    post:
      tags:
        - File Imports
      summary: Create a File Import
      description: Creates a new file import operation for importing CSV or Parquet files into a database table.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateFileImportInput'
      responses:
        '201':
          description: File import created successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message if the creation failed.
        '4XX':
          $ref: '#/components/responses/ClientError'

  /projects/{project_id}/services/{service_id}/fileimports/{import_id}:
    get:
      tags:
        - File Imports
      summary: Get a File Import
      description: Retrieves the details of a specific file import by its ID.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
        - $ref: '#/components/parameters/FileImportId'
      responses:
        '200':
          description: File import details.
          content:
            application/json:
              schema:
                type: object
                required:
                  - file_import
                properties:
                  file_import:
                    $ref: '#/components/schemas/FileImport'
        '4XX':
          $ref: '#/components/responses/ClientError'
    patch:
      tags:
        - File Imports
      summary: Update a File Import
      description: Updates a file import by applying one or more operations such as canceling, retrying, or updating labels.
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - $ref: '#/components/parameters/ServiceId'
        - $ref: '#/components/parameters/FileImportId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateFileImportInput'
      responses:
        '200':
          description: File import updated successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message if the update failed.
        '4XX':
          $ref: '#/components/responses/ClientError'

components:
  parameters:
    ProjectId:
      name: project_id
      in: path
      required: true
      description: The unique identifier of the project.
      schema:
        type: string
        example: "rp1pz7uyae"
    ServiceId:
      name: service_id
      in: path
      required: true
      description: The unique identifier of the service.
      schema:
        type: string
        example: "d1k5vk7hf2"
    ReplicaSetId:
      name: replica_set_id
      in: path
      required: true
      description: The unique identifier of the read replica set.
      schema:
        type: string
        example: "alb8jicdpr"
    VPCId:
      name: vpc_id
      in: path
      required: true
      description: The unique identifier of the VPC.
      schema:
        type: string
        example: "1234567890"
    PeeringId:
      name: peering_id
      in: path
      required: true
      description: The unique identifier of the VPC peering connection.
      schema:
        type: string
        example: "1234567890"
    FileImportId:
      name: import_id
      in: path
      required: true
      description: The unique identifier of the file import.
      schema:
        type: string
        example: 'import-123abc'

  schemas:
    VPC:
      type: object
      properties:
        id:
          type: string
          readOnly: true
          example: "1234567890"
        name:
          type: string
          example: "my-production-vpc"
        cidr:
          type: string
          example: "10.0.0.0/16"
        region_code:
          type: string
          example: "us-east-1"
    VPCCreate:
      type: object
      required:
        - name
        - cidr
        - region_code
      properties:
        name:
          type: string
          example: "my-production-vpc"
        cidr:
          type: string
          example: "10.0.0.0/16"
        region_code:
          type: string
          example: "us-east-1"
    VPCRename:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: The new name for the VPC.
          example: "my-renamed-vpc"
    Peering:
      type: object
      properties:
        id:
          type: string
          readOnly: true
          example: "1234567890"
        peer_account_id:
          type: string
          example: "acc-12345"
        peer_region_code:
          type: string
          example: "aws-us-east-1"
        peer_vpc_id:
          type: string
          example: "1234567890"
        provisioned_id:
          type: string
          example: "1234567890"
        status:
          type: string
          example: "active"
        error_message:
          type: string
          example: "VPC not found"
    PeeringCreate:
      type: object
      required:
        - peer_account_id
        - peer_region_code
        - peer_vpc_id
      properties:
        peer_account_id:
          type: string
          example: "acc-12345"
        peer_region_code:
          type: string
          example: "aws-us-east-1"
        peer_vpc_id:
          type: string
          example: "1234567890"
    Endpoint:
      type: object
      properties:
        host:
          type: string
          example: "my-service.com"
        port:
          type: integer
          example: 8080
    ConnectionPooler:
      type: object
      properties:
        endpoint:
          $ref: '#/components/schemas/Endpoint'
    Service:
      type: object
      properties:
        service_id:
          type: string
          description: The unique identifier for the service.
        project_id:
          type: string
          description: The project this service belongs to.
        name:
          type: string
          description: The name of the service.
        region_code:
          type: string
          description: The cloud region where the service is hosted.
          example: "us-east-1"
        service_type:
          $ref: '#/components/schemas/ServiceType'
          description: The type of the service.
        created:
          type: string
          format: date-time
          description: Creation timestamp
        initial_password:
          type: string
          description: The initial password for the service.
          format: password
          example: "a-very-secure-initial-password"
        paused:
          type: boolean
          description: Whether the service is paused
        status:
          $ref: '#/components/schemas/DeployStatus'
          description: Current status of the service
        resources:
          type: array
          description: List of resources allocated to the service
          items:
            type: object
            properties:
              id:
                type: string
                description: Resource identifier
              spec:
                type: object
                description: Resource specification
                properties:
                  cpu_millis:
                    type: integer
                    description: CPU allocation in millicores
                  memory_gbs:
                    type: integer
                    description: Memory allocation in gigabytes
                  volume_type:
                    type: string
                    description: Type of storage volume
        metadata:
          type: object
          description: Additional metadata for the service
          properties:
            environment:
              type: string
              description: Environment tag for the service
        endpoint:
          $ref: '#/components/schemas/Endpoint'
        vpcEndpoint:
          type: object
          nullable: true
          description: VPC endpoint configuration if available
        forked_from:
          $ref: '#/components/schemas/ForkSpec'
        ha_replicas:
          $ref: '#/components/schemas/HAReplica'
        connection_pooler:
          $ref: '#/components/schemas/ConnectionPooler'
        read_replica_sets:
          type: array
          items:
            $ref: '#/components/schemas/ReadReplicaSet'
    ServiceType:
      type: string
      enum:
      - TIMESCALEDB
      - POSTGRES
      - VECTOR
    EnvironmentTag:
        type: string
        enum:
        - DEV
        - PROD
        description: The environment tag for the service.
    ForkStrategy:
      type: string
      enum:
      - LAST_SNAPSHOT
      - NOW
      - PITR
      description: |
        Strategy for creating the fork:
        - LAST_SNAPSHOT: Use existing snapshot for fast fork
        - NOW: Create new snapshot for up-to-date fork
        - PITR: Point-in-time recovery using target_time
    DeployStatus:
      type: string
      enum:
      - QUEUED
      - DELETING
      - CONFIGURING
      - READY
      - DELETED
      - UNSTABLE
      - PAUSING
      - PAUSED
      - RESUMING
      - UPGRADING
      - OPTIMIZING
    ForkSpec:
      type: object
      properties:
        project_id:
          type: string
          example: "asda1b2c3"
        service_id:
          type: string
          example: "bbss422fg"
        is_standby:
          type: boolean
          example: false
    ReadReplicaSet:
      type: object
      properties:
        id:
          type: string
          example: "alb8jicdpr"
        name:
          type: string
          example: "reporting-replica-1"
        status:
          type: string
          enum: [creating, active, resizing, deleting, error]
          example: "active"
        nodes:
          type: integer
          description: Number of nodes in the replica set.
          example: 2
        cpu_millis:
          type: integer
          description: CPU allocation in milli-cores.
          example: 250
        memory_gbs:
          type: integer
          description: Memory allocation in gigabytes.
          example: 1
        metadata:
          type: object
          description: Additional metadata for the read replica set
          properties:
            environment:
              type: string
              description: Environment tag for the read replica set
        endpoint:
          $ref: '#/components/schemas/Endpoint'
        connection_pooler:
          $ref: '#/components/schemas/ConnectionPooler'
    ServiceCreate:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: A human-readable name for the service.
          example: "my-production-db"
        addons:
          type: array
          items:
            type: string
            enum: ["time-series", "ai"]
          description: List of addons to enable for the service. 'time-series' enables TimescaleDB, 'ai' enables AI/vector extensions.
          example: ["time-series", "ai"]
        region_code:
          type: string
          description: The region where the service will be created. If not provided, we'll choose the best region for you.
          example: "us-east-1"
        replica_count:
          type: integer
          description: Number of high-availability replicas to create (all replicas are asynchronous by default).
          example: 2
        cpu_millis:
          type: string
          description: The initial CPU allocation in milli-cores, or 'shared' for a shared-resource service.
          example: "1000"
        memory_gbs:
          type: string
          description: The initial memory allocation in gigabytes, or 'shared' for a shared-resource service.
          example: "4"
        environment_tag:
          $ref: '#/components/schemas/EnvironmentTag'
          description: The environment tag for the service, 'DEV' by default.
          default: DEV
    ForkServiceCreate:
      type: object
      required:
        - fork_strategy
      properties:
        name:
          type: string
          description: A human-readable name for the forked service. If not provided, will use parent service name with "-fork" suffix.
          example: "my-production-db-fork"
        cpu_millis:
          type: string
          description: The initial CPU allocation in milli-cores, or 'shared' for a shared-resource service. If not provided, will inherit from parent service.
          example: "1000"
        memory_gbs:
          type: string
          description: The initial memory allocation in gigabytes, or 'shared' for a shared-resource service. If not provided, will inherit from parent service.
          example: "4"
        fork_strategy:
          $ref: '#/components/schemas/ForkStrategy'
          description: Strategy for creating the fork. This field is required.
        target_time:
          type: string
          format: date-time
          description: Target time for point-in-time recovery. Required when fork_strategy is PITR.
          example: "2024-01-01T00:00:00Z"
        environment_tag:
          $ref: '#/components/schemas/EnvironmentTag'
          description: The environment tag for the forked service, 'DEV' by default.
          default: DEV
      description: |
        Create a fork of an existing service. Service type, region code, and storage are always inherited from the parent service.
        HA replica count is always set to 0 for forked services.
    HAReplica:
      type: object
      properties:
        sync_replica_count:
          type: integer
          description: Number of synchronous high-availability replicas.
          example: 1
        replica_count:
          type: integer
          description: Number of high-availability replicas (all replicas are asynchronous by default).
          example: 1
    SetHAReplicaInput:
      type: object
      properties:
        sync_replica_count:
          type: integer
          description: Number of synchronous high-availability replicas.
          example: 1
        replica_count:
          type: integer
          description: Number of high-availability replicas (all replicas are asynchronous by default).
          example: 1
      description: At least one of sync_replica_count or replica_count must be provided.
    ReadReplicaSetCreate:
      type: object
      required:
        - name
        - nodes
        - cpu_millis
        - memory_gbs
      properties:
        name:
          type: string
          description: A human-readable name for the read replica.
          example: "my-reporting-replica"
        nodes:
          type: integer
          description: Number of nodes to create in the replica set.
          example: 2
        cpu_millis:
          type: integer
          description: The initial CPU allocation in milli-cores.
          example: 250
        memory_gbs:
          type: integer
          description: The initial memory allocation in gigabytes.
          example: 1
    ResizeInput:
      type: object
      required:
        - cpu_millis
        - memory_gbs
      properties:
        cpu_millis:
          type: integer
          description: The new CPU allocation in milli-cores (e.g., 1000 for 1 vCPU).
          example: 1000
        memory_gbs:
          type: integer
          description: The new memory allocation in gigabytes.
          example: 4
        nodes:
          type: integer
          description: The new number of nodes in the replica set.
          example: 2
    UpdatePasswordInput:
      type: object
      required:
        - password
      properties:
        password:
          type: string
          description: The new password.
          format: password
          example: "a-very-secure-new-password"
    SetEnvironmentInput:
      type: object
      required:
        - environment
      properties:
        environment:
          type: string
          description: The target environment for the service.
          enum: [PROD, DEV]
      example:
        environment: "PROD"
    ServiceVPCInput:
      type: object
      required:
        - vpc_id
      properties:
        vpc_id:
          type: string
          description: The ID of the VPC to attach the service to.
          example: "1234567890"
    FileImportSourceType:
      type: string
      enum:
        - S3
        - HTTP
        - INTERNAL
      description: The type of source for the file import.
    FileImportS3Source:
      type: object
      required:
        - key
        - bucket
      properties:
        id:
          type: string
          description: The identifier for this source (deprecated, not actively used).
          example: 'source-123'
        key:
          type: string
          description: The S3 object key.
          example: 'data/2024/sales.csv'
        bucket:
          type: string
          description: The S3 bucket name.
          example: 'my-data-bucket'
        role_arn:
          type: string
          description: AWS IAM role ARN for accessing the S3 bucket.
          example: 'arn:aws:iam::123456789012:role/S3AccessRole'
    FileImportHTTPSource:
      type: object
      required:
        - url
      properties:
        url:
          type: string
          description: The HTTP(S) URL to download the file from.
          example: 'https://example.com/data/sales.csv'
    FileImportInternalSource:
      type: object
      required:
        - id
      properties:
        id:
          type: string
          description: Internal identifier for the uploaded file.
          example: 'internal-upload-123'
    FileImportSource:
      type: object
      required:
        - type
      properties:
        type:
          $ref: '#/components/schemas/FileImportSourceType'
        s3:
          $ref: '#/components/schemas/FileImportS3Source'
        http:
          $ref: '#/components/schemas/FileImportHTTPSource'
        internal:
          $ref: '#/components/schemas/FileImportInternalSource'
      description: Source configuration for the file import. Only one of s3, http, or internal should be set based on type.
    FileImportDefinitionType:
      type: string
      enum:
        - CSV
        - PARQUET
      description: The file format type.
    ColumnMapping:
      type: object
      required:
        - source
        - destination
      properties:
        source:
          type: string
          description: Source column name in the original file.
          example: 'customer_name'
        destination:
          type: string
          description: Destination column name in the target table.
          example: 'name'
    FileImportDefinitionCSV:
      type: object
      properties:
        delimiter:
          type: string
          description: The delimiter character for CSV files.
          default: ','
          example: ','
        skip_header:
          type: boolean
          description: Whether to skip the first row as a header. Required for column_mappings and auto_column_mapping.
          default: false
        column_names:
          type: array
          items:
            type: string
          description: Column names matching the destination table. Mutually exclusive with column_mappings and auto_column_mapping.
          example: ['id', 'name', 'created_at']
        column_mappings:
          type: array
          items:
            $ref: '#/components/schemas/ColumnMapping'
          description: Mappings from source to destination columns. Requires skip_header=true. Mutually exclusive with column_names and auto_column_mapping.
        auto_column_mapping:
          type: boolean
          description: Automatically map columns by matching header names. Requires skip_header=true. Mutually exclusive with column_names and column_mappings.
          default: false
    FileImportDefinitionParquet:
      type: object
      properties:
        column_mappings:
          type: array
          items:
            $ref: '#/components/schemas/ColumnMapping'
          description: Mappings from source to destination columns. Mutually exclusive with auto_column_mapping.
        auto_column_mapping:
          type: boolean
          description: Automatically map columns by matching header names. Mutually exclusive with column_mappings.
          default: false
    FileImportDefinition:
      type: object
      required:
        - type
      properties:
        type:
          $ref: '#/components/schemas/FileImportDefinitionType'
        csv:
          $ref: '#/components/schemas/FileImportDefinitionCSV'
        parquet:
          $ref: '#/components/schemas/FileImportDefinitionParquet'
      description: File format definition. Only csv or parquet should be set based on type.
    TableIdentifier:
      type: object
      required:
        - table_name
      properties:
        schema_name:
          type: string
          description: PostgreSQL schema name. Defaults to 'public' if not specified.
          example: 'analytics'
        table_name:
          type: string
          description: PostgreSQL table name.
          example: 'sales_data'
    FileImportState:
      type: string
      enum:
        - WAITING_FOR_UPLOAD
        - IN_QUEUE
        - RUNNING
        - RETRYING
        - SUCCESS
        - FAILURE
        - CANCELLED
        - PAUSED
        - SKIPPED
      description: Current state of the file import operation.
    FileImportStateTimeline:
      type: object
      properties:
        at:
          type: string
          format: date-time
          description: Timestamp when this state was entered.
          example: '2024-01-15T10:30:00Z'
        state:
          type: string
          description: The state that was entered.
          example: 'SUCCESS'
        payload:
          type: object
          properties:
            failure_reason:
              type: string
              description: Reason for failure, if applicable.
            retry_at:
              type: string
              format: date-time
              description: Scheduled retry time, if applicable.
          description: Additional information about the state change.
    FileImportStateInfo:
      type: object
      required:
        - state
      properties:
        state:
          $ref: '#/components/schemas/FileImportState'
        progress:
          type: object
          properties:
            current:
              type: integer
              description: Current progress value.
              example: 5000
            total:
              type: integer
              description: Total expected value.
              example: 10000
            message:
              type: string
              description: Human-readable progress message.
              example: 'Processing rows'
        failure_reason:
          type: string
          description: Detailed failure reason if state is FAILURE.
          example: 'Invalid data format in row 1234'
        timelines:
          type: array
          items:
            $ref: '#/components/schemas/FileImportStateTimeline'
          description: History of state transitions.
    FileImportLabel:
      type: object
      required:
        - key
        - value
      properties:
        key:
          type: string
          description: Label key for filtering.
          example: 'source'
        value:
          type: string
          description: Label value.
          example: 's3-live-sync'
    ImportSettings:
      type: object
      properties:
        on_conflict_do_nothing:
          type: boolean
          description: Handle conflicts by ignoring conflicting rows.
          default: false
    FileImport:
      type: object
      required:
        - service_id
        - project_id
        - id
        - created_at
        - updated_at
        - source
        - definition
        - table_identifier
        - state
        - labels
        - size
      properties:
        service_id:
          type: string
          description: Service identifier.
          example: 'd1k5vk7hf2'
        project_id:
          type: string
          description: Project identifier.
          example: 'rp1pz7uyae'
        id:
          type: string
          description: Unique file import identifier.
          example: 'import-123abc'
        created_at:
          type: string
          format: date-time
          description: Creation timestamp.
          example: '2024-01-15T10:00:00Z'
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp.
          example: '2024-01-15T10:30:00Z'
        source:
          $ref: '#/components/schemas/FileImportSource'
        definition:
          $ref: '#/components/schemas/FileImportDefinition'
        table_identifier:
          $ref: '#/components/schemas/TableIdentifier'
        state:
          $ref: '#/components/schemas/FileImportStateInfo'
        labels:
          type: array
          items:
            $ref: '#/components/schemas/FileImportLabel'
          description: Labels for filtering and organization.
        size:
          type: integer
          description: File size in bytes.
          example: 1048576
        settings:
          $ref: '#/components/schemas/ImportSettings'
    CreateFileImportInput:
      type: object
      required:
        - id
        - source
        - definition
        - table_identifier
      properties:
        id:
          type: string
          description: Unique identifier for this file import.
          example: 'import-123abc'
        source:
          $ref: '#/components/schemas/FileImportSource'
        definition:
          $ref: '#/components/schemas/FileImportDefinition'
        table_identifier:
          $ref: '#/components/schemas/TableIdentifier'
        labels:
          type: array
          items:
            $ref: '#/components/schemas/FileImportLabel'
          description: Optional labels for filtering.
        settings:
          $ref: '#/components/schemas/ImportSettings'
    UpdateFileImportRequestType:
      type: string
      enum:
        - cancel
        - labels
        - retry
      description: Type of update operation to perform.
    UpdateFileImportRequestCancel:
      type: object
      required:
        - reason
      properties:
        reason:
          type: string
          description: Reason for cancellation.
          example: 'User requested cancellation'
    UpdateFileImportRequestLabels:
      type: object
      required:
        - labels
      properties:
        labels:
          type: array
          items:
            $ref: '#/components/schemas/FileImportLabel'
          description: New labels to set.
    UpdateFileImportRequest:
      type: object
      required:
        - type
      properties:
        type:
          $ref: '#/components/schemas/UpdateFileImportRequestType'
        cancel:
          $ref: '#/components/schemas/UpdateFileImportRequestCancel'
        labels:
          $ref: '#/components/schemas/UpdateFileImportRequestLabels'
      description: Update request. Only one of cancel or labels should be set based on type.
    UpdateFileImportInput:
      type: object
      required:
        - requests
      properties:
        requests:
          type: array
          items:
            $ref: '#/components/schemas/UpdateFileImportRequest'
          description: List of update operations to perform.
          minItems: 1
    PageInfo:
      type: object
      required:
        - has_next_page
        - has_previous_page
      properties:
        end_cursor:
          type: string
          description: Cursor for fetching the next page.
          example: 'eyJpZCI6IjEyMyJ9'
        start_cursor:
          type: string
          description: Cursor for fetching the previous page.
          example: 'eyJpZCI6IjEwMCJ9'
        has_next_page:
          type: boolean
          description: Whether there is a next page.
          example: true
        has_previous_page:
          type: boolean
          description: Whether there is a previous page.
          example: false
    ListFileImportResponse:
      type: object
      required:
        - file_imports
        - page_info
      properties:
        file_imports:
          type: array
          items:
            $ref: '#/components/schemas/FileImport'
          description: List of file imports.
        page_info:
          $ref: '#/components/schemas/PageInfo'
    GeneratePresignedURLInput:
      type: object
      required:
        - id
        - content_length
      properties:
        id:
          type: string
          description: Unique identifier for the file. This will be used later when creating the file import.
          example: "my-upload-123"
        content_length:
          type: integer
          description: Exact size of the file to upload in bytes. Must match the Content-Length header during upload.
          minimum: 1
          maximum: 524288000
          example: 1048576
    GeneratePresignedURLResponse:
      type: object
      required:
        - url
      properties:
        url:
          type: string
          description: Presigned S3 URL for uploading the file. Valid for a limited time.
          example: "https://s3.amazonaws.com/bucket/key?X-Amz-Signature=..."
    Error:
      type: object
      properties:
        code:
          type: string
        message:
          type: string

  responses:
    AnalyticsResponse:
      description: Analytics action completed successfully.
      content:
        application/json:
          schema:
            type: object
            properties:
              status:
                type: string
                description: Status of the analytics operation
                example: "success"
    SuccessMessage:
      description: The action was completed successfully.
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Action completed successfully."
    ClientError:
      description: Client error response (4xx status codes).
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
